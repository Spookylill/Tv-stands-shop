<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - TV Stands</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<script>
const pass = prompt("Enter admin password:");
if (pass !== "admin123") {
    alert("Access denied");
    window.location.href = "index.html";
}
</script>

<header>
<h1>Admin Panel</h1>
</header>

<main>

<form id="settingsForm">
    <input type="text" id="whatsappNumber" placeholder="WhatsApp number (0780810327)" required>
    <button type="submit">Save WhatsApp Number</button>
</form>

<form id="productForm">
    <input type="text" id="name" placeholder="Product Name" required>
    <input type="number" id="price" placeholder="Price (KSh)" required>
    <input type="file" id="imageFile" accept="image/*" required>
    <button type="submit">Add Product</button>
</form>

<div id="productList" class="products"></div>

</main>

<footer>
<p>&copy; 2026 TV Stands Shop - Admin</p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, setDoc, getDoc }
from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject }
from "https://www.gstatic.com/firebasejs/10.6.0/firebase-storage.js";

/* ðŸ”´ PUT YOUR REAL FIREBASE DETAILS HERE */
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "XXXX",
    appId: "XXXX"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

/* SAVE WHATSAPP */
document.getElementById("settingsForm").addEventListener("submit", async e => {
    e.preventDefault();
    let num = document.getElementById("whatsappNumber").value;
    num = num.replace(/^0/, "254");
    await setDoc(doc(db, "settings", "whatsapp"), { number: num });
    alert("WhatsApp number saved");
});

/* ADD PRODUCT */
document.getElementById("productForm").addEventListener("submit", async e => {
    e.preventDefault();

    const name = document.getElementById("name").value;
    const price = document.getElementById("price").value;
    const image = document.getElementById("imageFile").files[0];

    const wsDoc = await getDoc(doc(db, "settings", "whatsapp"));
    if (!wsDoc.exists()) return alert("Save WhatsApp number first!");

    const whatsapp = wsDoc.data().number;
    const imgRef = ref(storage, "products/" + Date.now() + image.name);
    await uploadBytes(imgRef, image);
    const imgURL = await getDownloadURL(imgRef);

    await addDoc(collection(db, "products"), {
        name,
        price,
        image: imgURL,
        whatsapp
    });

    alert("Product added");
    loadProducts();
});

/* LOAD PRODUCTS */
async function loadProducts() {
    productList.innerHTML = "";
    const data = await getDocs(collection(db, "products"));
    data.forEach(d => {
        const p = d.data();
        productList.innerHTML += `
        <div class="product">
            <img src="${p.image}">
            <h2>${p.name}</h2>
            <div class="price">KSh ${p.price}</div>
            <a class="buy-btn" target="_blank"
               href="https://wa.me/${p.whatsapp}?text=Hello I want ${p.name}">
               WhatsApp
            </a>
            <button class="delete-btn"
                onclick="deleteProduct('${d.id}','${p.image}')">
                Delete
            </button>
        </div>`;
    });
}

window.deleteProduct = async (id, img) => {
    await deleteDoc(doc(db, "products", id));
    await deleteObject(ref(storage, img)).catch(()=>{});
    loadProducts();
};

loadProducts();
</script>

</body>
</html>
